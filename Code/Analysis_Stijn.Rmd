---
title: "Analysis"
author: "Stijn van den Broek"
date: "02/05/2021"
output: html_document
---

```{r}
library(ggplot2)
library(tidyverse)
library(corrplot)
```

```{r}
data = read.csv('diabetes.csv')
```

```{r}
analysis_model = function(data, model, print = FALSE, synthetic = FALSE) {
  
  analyse_dataframe = function(dataframe, printing = print) {
    coefficient_row = rep(NA, 0)
    for (i in seq(1, nrow(tidy(model)), 1)) {
      row = tidy(model)[i,]
      names(row) = paste0(row$term, '_', names(row))
      row = row[-1]
      coefficient_row = c(coefficient_row, row)
    }
    if (printing == TRUE){
      print(summary(model))
    }
    return(coefficient_row)
  }
  
  if (synthetic == TRUE) {
    coefficient_dataframe = data.frame()
    nsim = 1
    for (i in dataframe) {
      m = 1
      for (n in i) {
        coefficient_row = analyse_dataframe(n)
        coefficient_row = coefficient_row %>% 
          c(nsim) %>% 
          c(m) %>% 
          data.frame()
        names(coefficient_row)[(ncol(coefficient_row)-1)] = "nsim"
        names(coefficient_row)[ncol(coefficient_row)] = "m"
        coefficient_dataframe = rbind(coefficient_dataframe, coefficient_row)
        m = m+1
      }
      i = i+1
    }
  }
  
  else {
    coefficient_dataframe = data.frame(analyse_dataframe(data))
  }
  
  return(coefficient_dataframe)
}
```

```{r}
#Dataframe maken waarbij de statistical properties worden opgeslagen van elke m van elke sim.
statistical_properties = function(dataframe) {
  print(apply(dataframe, 2, mean))
  print(apply(dataframe, 2, var))
  print(corrplot(cor(dataframe), method = "color"))
}
```

```{r}
dataset_distribution = function(dataframe) {
  ggplot(gather(dataframe), aes(value)) + 
    geom_histogram(bins = 10) + 
    facet_wrap(~key, scales = 'free_x')
}
```

```{r}
model = glm(Outcome~Pregnancies+Glucose, data = data, family = "binomial")
analysis = analysis_model(data, model = model, print = FALSE)
```

```{r}
statistical_properties(data)
```

```{r}
dataset_distribution(data)
```
